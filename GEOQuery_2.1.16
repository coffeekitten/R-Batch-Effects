---
title: "GEOQuery Data Collection"
author: "Jessica Phung"
date: "February 1, 2016"
output: html_document
---
##GEOQuery is used for collecting data off of the NCBI GEO website into R. Each user uploaded dataset has its own GEO accession idenifier which is inputed in the function getGEO function.

##The dataset below downloading expressionset data on lung tissue samples from Texas. The data will down load as a list. But it is important to format it into an expression set which will allow for easier data manipulation.   

gse <- getGEO("GSE1643",GSEMatrix=FALSE)

##To start converting a gse to an expression set use the code below. 

gsmplatforms <-lapply(GSMList(gse),function(x){Meta(x)$platform})
head(gsmplatforms) 

##This should show you the platforms the data was collected on. A platform is the method they used to collect their data. 

##If your data has more than one platform you can filter out columns of data you don't want. In this case we want ____ platform.

gsmlist = Filter(function(gsm){Meta(gsm)$platform=='GPL96'},GSMList(gse))
length(gsmlist)

#To check the column desciptions do this below. 

Columns(gsmlist[[1]])[1:5,]

##This is how to attach the gene expression data to the probes. 

probesets <- Table(GPLList(gse)[[1]])$ID
data.matrix <- do.call('cbind',lapply(gsmlist,function(x) {tab <- Table(x)mymatch <- match(probesets,tab$ID_REF)return(tab$VALUE[mymatch])}))
data.matrix <- apply(data.matrix,2,function(x){as.numeric(as.character(x))})
data.matrix <- log2(data.matrix)
data.matrix[1:5,]

##Now to put it all together into an expression set, use the code below. 

require(Biobase)
rownames(data.matrix) <- probesets
colnames(data.matrix) <- names(gsmlist)
pdata <- data.frame(samples=names(gsmlist))
rownames(pdata) <- names(gsmlist)
pheno <- as(pdata,"AnnotatedDataFrame")
eset2 <- new('ExpressionSet',exprs=data.matrix,phenoData=pheno)
eset2

##And the output should be the data formated. For the second data set from NCBI GEO I put the code below without the explainations. Using the same process the secons data set is reformated into an expression set. 

gse1 <- getGEO("GSE51024",GSEMatrix=FALSE)